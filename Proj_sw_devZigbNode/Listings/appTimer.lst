C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE APPTIMER
OBJECT MODULE PLACED IN .\Output\appTimer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Usr\appTimer.c OMF2 OPTIMIZE(9,SPEED) BROWSE INCDIR(.\Usr;.\Usr_lib;.\st
                    -d_Lib;.\dataTrans;.\Actuator;.\Sensor;.\hwDriver) DEBUG PRINT(.\Listings\appTimer.lst) OBJECT(.\Output\appTimer.obj)

line level    source

   1          #include "appTimer.h"
   2          
   3          #include "STC15Fxxxx.H"
   4          
   5          #include "stdio.h"
   6          #include "string.h"
   7          
   8          #include "USART.h"
   9          
  10          #include "dataManage.h"
  11          #include "devlopeDebug.h"
  12          
  13          #include "Relay.h"
  14          #include "timerAct.h"
  15          #include "touchPad.h"
  16          #include "dataTrans.h"
  17          #include "Tips.h"
  18          #include "usrKin.h"
  19          #include "driver_I2C_HXD019D.h"
  20          #include "DS18B20.h"
  21          
  22          //***************Êý¾Ý´«Êä±äÁ¿ÒýÓÃÇø***************************/
  23          extern bit                              rxTout_count_EN;        
  24          extern u8                               rxTout_count;   //´®¿Ú½ÓÊÕ³¬Ê±¼ÆÊý
  25          extern bit                              uartRX_toutFLG;
  26          extern u8                               datsRcv_length;
  27          extern uartTout_datsRcv xdata datsRcv_ZIGB;
  28          
  29          extern u16 xdata                zigbNwkAction_counter; //zigbÍøÂçÖØÁ¬×¨ÓÃ¶¯×÷Ê±¼ä¼ÆÊý
  30          
  31          extern u16 xdata                dtReqEx_counter; //À©Õ¹ÐÍÊý¾Ý·¢ËÍ¼ä¸ô¼ÆÊ±Öµ
  32          
  33          extern bit                              heartBeatCycle_FLG;     //ÐÄÌøÖÜÆÚ´¥·¢±êÖ¾
  34          extern u8 xdata                 heartBeatCount; //ÐÄÌø¼ÆÊý
  35          extern u8 xdata                 heartBeatPeriod; //ÐÄÌøÖÜÆÚ
  36          extern u8 xdata                 heartBeatHang_timeCnt;
  37          
  38          extern u8 xdata                 colonyCtrlGet_queryCounter; 
  39          extern u8 xdata                 colonyCtrlGetHang_timeCnt;
  40          
  41          //***************°´¼üÊäÈë±äÁ¿ÒýÓÃÇø***************************/
  42          extern bit                              usrKeyCount_EN;
  43          extern u16                              usrKeyCount;
  44          
  45          extern u16 xdata                touchPadActCounter;
  46          extern u16 xdata                touchPadContinueCnt;
  47          
  48          extern u16 xdata                combinationFunFLG_3S5S_cancel_counter;
  49          
  50          //***************Tips±äÁ¿ÒýÓÃÇø***************************/
  51          extern u16 xdata                counter_tipsAct;
  52          
  53          /*-----------------------------------------------------------------------------------------------*/
  54          void appTimer0_Init(void){      //50us ÖÐ¶Ï@24.000M
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 2   

  55   1      
  56   1              AUXR |= 0x80;           
  57   1              TMOD &= 0xF0;           
  58   1              TL0   = 0x50;           
  59   1              TH0   = 0xFB;   
  60   1              TF0   = 0;      
  61   1              ET0       = 1;  //¿ªÖÐ¶Ï
  62   1              PT0   = 1;      
  63   1              
  64   1              TR0   = 1;              
  65   1      }
  66          
  67          void appTimer4_Init(void){      //50us ÖÐ¶Ï@24.000M
  68   1              
  69   1              T4T3M   |= 0x20;                
  70   1              T4L     = 0x50;         
  71   1              T4H     = 0xFB;         
  72   1              T4T3M   |= 0x80;        
  73   1      
  74   1              IE2     |= 0x40;
  75   1      }
  76          
  77          void timer0_Rountine (void) interrupt TIMER0_VECTOR{
  78   1              
  79   1      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
                      {
                              
                              u8 xdata freq_periodBeatHalf = dimmer_freqParam.periodBeat_cfm / 2;
              
                              dimmer_freqParam.periodBeat_counter ++; //µçÔ´ÆµÂÊµ¥ÖÜÆÚ½ÚÅÄÊý¸üÐÂ
                              
                              if(dimmer_freqParam.pwm_actEN){         
                              
                                      dimmer_freqParam.pwm_actCounter ++;
                                      
                                      if(dimmer_freqParam.pwm_actCounter <= status_Relay && dimmer_freqParam.pwm_actCounter < freq_periodBeat
             -Half){ //Ç°°ëÖÜ
                                              
                                              PIN_PWM_OUT = 1;
                                              
                                      }else{
                                      
                                              dimmer_freqParam.pwm_actCounter = 0;
                                              dimmer_freqParam.pwm_actEN = 0;
                                              PIN_PWM_OUT = 0;
                                      }
                                      
              //                      if(dimmer_freqParam.pwm_actCounter <= freq_periodBeatHalf){
              //                      
              //                              if(dimmer_freqParam.pwm_actCounter < status_Relay){
              //                                      
              //                                      PIN_PWM_OUT = 1;
              //                                      
              //                              }else{
              //                              
              //                                      PIN_PWM_OUT = 0;
              //                              }
              //                              
              ////                            PIN_PWM_OUT = 0;
              //                      
              //                      }else
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 3   

              //                      if(dimmer_freqParam.pwm_actCounter > freq_periodBeatHalf && dimmer_freqParam.pwm_actCounter <= dimmer
             -_freqParam.periodBeat_cfm){
              //                              
              ////                            if((dimmer_freqParam.pwm_actCounter - freq_periodBeatHalf) < status_Relay){
              ////                                    
              ////                                    PIN_PWM_OUT = 1;
              ////                                    
              ////                            }else{
              ////                            
              ////                                    PIN_PWM_OUT = 0;
              ////                            }
              //                              
              //                              PIN_PWM_OUT = 0;
              
              //                      }else{
              //                      
              //                              dimmer_freqParam.pwm_actCounter = 0;
              //                              dimmer_freqParam.pwm_actEN = 0;
              //                              PIN_PWM_OUT = 0;
              //                      }
                                      
                              }else{
                              
                                      PIN_PWM_OUT = 0;
                              }
                      }
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
                      u16 code period_1second = 20000;
                      static u16 counter_1second = 0; 
                      u8 code period_1second_x5 = 5;
                      static u8 counter_1second_x5 = 0; 
                      
                      if(counter_1second < period_1second)counter_1second ++; //1s
                      else{
                      
                              counter_1second = 0;
                              
                              if(counter_1second_x5 < period_1second_x5)counter_1second_x5 ++; //5s
                              else{
                              
                                      counter_1second_x5 = 0;
                                      
              //                      /*¸¡µãÊý´«Êä²âÊÔ*/
              //                      socket_eleDetParam.eleParamFun_powerFreqVal     = 111.12345F;
              //                      socket_eleDetParam.eleParam_power                               = 122.12345F;
              //                      socket_eleDetParam.ele_Consum                                   = 253.11111F;
                                      
                                      socket_eleDetParam.eleParamFun_powerFreqVal = socket_eleDetParam.eleParamFun_powerPulseCount / 5.0F; //
             -ÆµÂÊ
                                      socket_eleDetParam.eleParam_power = socket_eleDetParam.eleParamFun_powerFreqVal * (COEFFICIENT_POW - (C
             -OEFFICIENT_COMPENSATION_POW * socket_eleDetParam.eleParamFun_powerFreqVal)); //¹¦ÂÊ
                                      
                                      if(socket_eleDetParam.eleParamFun_powerFreqVal < 0.00001F)socket_eleDetParam.eleParamFun_powerFreqVal =
             - 0.00001F; //×îÐ¡ÖµÏÞ¶¨
                                      socket_eleDetParam.ele_Consum   += 1.00F * (socket_eleDetParam.eleParamFun_powerPulseCount * socket_eleDe
             -tParam.eleParam_power / (1000.00F * 3600.00F * socket_eleDetParam.eleParamFun_powerFreqVal)); //ÓÃµçÁ¿
                                      
                                      socket_eleDetParam.eleParamFun_powerPulseCount = 0.0F; //Âö³å¼ÆÊýÇåÁã
                              }
                      }
              #else
 172   1      #endif
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 4   

 173   1      }
 174          
 175          void timer4_Rountine (void) interrupt TIMER4_VECTOR{
 176   1              
 177   1              u16 code period_1second = 20000;
 178   1              static u16 counter_1second = 0; 
 179   1              
 180   1              u8 code period_1ms              = 20;
 181   1              static u8 counter_1ms   = 0; 
 182   1              
 183   1      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SCENARIO)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
              #else
 190   1              u16 code period_200ms   = 4000; //counter_200ms¼ÆÊ±ÆµÂÊ µþ¼Ó counter5_200ms¼ÆÊ±ÆµÂÊ ¶ÔÓ¦µÄ1s¼ÆÊýÖÜÆÚ  4000
             - * 5 * 50 us = 1s
 191   1              static u16 counter_200ms = 0; 
 192   1              u8 code period5_200ms   = 5; //counter_200ms¼ÆÊ±ÆµÂÊ µþ¼Ó counter5_200ms¼ÆÊ±ÆµÂÊ ¶ÔÓ¦µÄ1s¼ÆÊýÖÜÆÚ  4000 * 
             -5 * 50 us = 1s
 193   1              static u8 counter5_200ms = 0; 
 194   1              
 195   1      #endif
 196   1              
 197   1              u8 code period_tipsColor = COLORGRAY_MAX * 3;
 198   1              static u8 counter_tipsColor = 0; 
 199   1              static color_Attr xdata cnt_relay1_Tips = {0};
 200   1              static color_Attr xdata cnt_relay2_Tips = {0};
 201   1              static color_Attr xdata cnt_relay3_Tips = {0};
 202   1              static color_Attr xdata cnt_zigbNwk_Tips = {0};
 203   1              
 204   1              static u8 xdata period_beep = 3;                //beep×¨ÓÃ
 205   1              static u8 xdata count_beep      = 0;
 206   1               
 207   1      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SCENARIO)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
              #else
 214   1              //****************100msÌØÊâ**********************************************/
 215   1              if(counter_200ms < period_200ms)counter_200ms ++;
 216   1              else{
 217   2                      
 218   2                      counter_200ms = 0;
 219   2                      counter5_200ms ++;
 220   2              
 221   2                      /*´°Á±Âß¼­ÒµÎñ£¬°´ÕÕ¹ìµÀÊ±¼ä¶¯×÷*/
 222   2                      if(SWITCH_TYPE == SWITCH_TYPE_CURTAIN){
 223   3                      
 224   3                              switch(curtainAct_Param.act){
 225   4                              
 226   4                                      case cTact_open:{
 227   5                                              
 228   5                                              if(curtainAct_Param.act_period){ //¹ìµÀÖÜÆÚÊ±¼ä·ÇÁãÊ±²Å½øÐÐÓÐÐ§¹ìµÀÊ±¼ä¼ÆÊ±ÒµÎñ
 229   6                                              
 230   6                                                      if(curtainAct_Param.act_counter < curtainAct_Param.act_period){
 231   7                                                      
 232   7                                                              if(counter5_200ms >= period5_200ms)curtainAct_Param.act_counter ++;
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 5   

 233   7                                                              
 234   7                                                      }else{
 235   7                                                      
 236   7                                                              curtainAct_Param.act = cTact_stop;
 237   7                                                      }       
 238   6                                              }
 239   5                                              
 240   5                                      }break;
 241   4                                              
 242   4                                      case cTact_close:{
 243   5                                              
 244   5                                              if(curtainAct_Param.act_period){ //¹ìµÀÖÜÆÚÊ±¼ä·ÇÁãÊ±²Å½øÐÐÓÐÐ§¹ìµÀÊ±¼ä¼ÆÊ±ÒµÎñ
 245   6                                              
 246   6                                                      if(curtainAct_Param.act_counter > 0){
 247   7                                                      
 248   7                                                              if(counter5_200ms >= period5_200ms)curtainAct_Param.act_counter --;
 249   7                                                              
 250   7                                                      }else{
 251   7                                                      
 252   7                                                              curtainAct_Param.act = cTact_stop;
 253   7                                                      }                                               
 254   6                                              }
 255   5                                      
 256   5                                      }break;
 257   4                                              
 258   4                                      case cTact_stop:{
 259   5                                      
 260   5                                              if(status_Relay != 2){
 261   6                                              
 262   6                                                      swCommand_fromUsr.objRelay = 2;
 263   6                                                      swCommand_fromUsr.actMethod = relay_OnOff;
 264   6                                                      devActionPush_IF.push_IF = 1; //ÍÆËÍÊ¹ÄÜ
 265   6                                              }
 266   5                                              
 267   5                                      }break;
 268   4                                              
 269   4                                      default:{}break;
 270   4                              }
 271   3                      }
 272   2                      
 273   2                      if(counter5_200ms >= period5_200ms)counter5_200ms = 0;
 274   2              }
 275   1      #endif
 276   1              
 277   1              //****************1ms×¨ÓÃ**********************************************/
 278   1              if(counter_1ms < period_1ms)counter_1ms ++;
 279   1              else{
 280   2              
 281   2                      counter_1ms = 0;
 282   2                      
 283   2      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
                              /*ºìÍâ×ª·¢×´Ì¬»ú×¨ÓÃ¶¯×÷Ê±¼ä¼ÆÊý*/
                              if(infraredAct_timeCounter)infraredAct_timeCounter --;
                              
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SCENARIO)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
                              /*ÈÈË®Æ÷¼ÌµçÆ÷ÖÍºóÍ¬²½¼ÆÊ±¼ÆÊý*/
                              if(heater_ActParam.relayActDelay_counter != COUNTER_DISENABLE_MASK_SPECIALVAL_U16){ //ÅÐ¶Ï¼ÆÊ±ÊÇ·ñ¿ÉÓÃ£¬
             -ÊÇ·ñÎª¼ÆÊ±Ê§Ð§ÑÚÂë
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 6   

                              
                                      if(heater_ActParam.relayActDelay_counter)heater_ActParam.relayActDelay_counter --; //¼ÌµçÆ÷¶¯×÷ÖÍºóÍ¬²½
             -¼ÆÊ±ÒµÎñÂß¼­
                                      else{
                                      
                                              heater_ActParam.relayActDelay_counter = COUNTER_DISENABLE_MASK_SPECIALVAL_U16;
                                              heater_ActParam.relayActDelay_actEn = 1;
                                      }
                              }
                              
              #else
 304   2      #endif
 305   2                      
 306   2                      /*zigb×¨ÓÃ¶¯×÷Ê±¼ä¼ÆÊý*/
 307   2                      if(zigbNwkAction_counter)zigbNwkAction_counter --;
 308   2                      
 309   2                      /*ÓÃ»§°´¼ü¶¯×÷×¨ÓÃÊ±¼ä¼ÆÊý*/
 310   2                      if(usrKeyCount_EN)usrKeyCount ++;
 311   2                      else usrKeyCount = 0;
 312   2                      
 313   2                      /*´¥Ãþ°´¼ü¶¯×÷×¨ÓÃÊ±¼ä¼ÆÊý*/
 314   2                      if(touchPadActCounter)touchPadActCounter --;
 315   2                      
 316   2                      /*´¥Ãþ°´¼üÁ¬°´×¨ÓÃÊ±¼ä¼ÆÊý*/
 317   2                      if(touchPadContinueCnt)touchPadContinueCnt --;
 318   2                      
 319   2                      /*Tips¶¯×÷×¨ÓÃÊ±¼ä¼ÆÊý*/
 320   2                      if(counter_tipsAct)counter_tipsAct --;
 321   2                      
 322   2                      /*À©Õ¹ÐÔ(³ÖÐøÐÔ)Êý¾Ý·¢ËÍ¶¯×÷¼ä¸ôÊ±¼ä¼ÆÊý*/
 323   2                      if(dtReqEx_counter)dtReqEx_counter --;
 324   2                      
 325   2                      /*ÌØÊâ×éºÏ¶¯×÷°´¼ü´¥·¢ Ô¤±êÖ¾ÏÎ½ÓÊ±¼ä¼ÆÊý*/
 326   2                      if(combinationFunFLG_3S5S_cancel_counter)combinationFunFLG_3S5S_cancel_counter --;
 327   2              }
 328   1              
 329   1              //****************1s×¨ÓÃ**********************************************/
 330   1              if(counter_1second < period_1second)counter_1second ++;
 331   1              else{
 332   2              
 333   2                      counter_1second = 0;
 334   2                      
 335   2      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
              //              /*µçÔ´ÆµÂÊµ¥ÖÜÆÚ½ÚÅÄÊýÍ³¼Æ*/
              //              /*>>>usr_debug<<<*/
              //              //usr_debugÊý¾ÝÌî×°
              //              dev_debugInfoLog.debugInfoData.dimmerInfo.soureFreq = dimmer_freqParam.periodBeat_cfm;
              //              //usr_debug´òÓ¡ÀàÐÍÌî×°Ìî×°
              //              dev_debugInfoLog.debugInfoType = infoType_dimmerFreq;
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
                              /*ds18b20ÎÂ¶È¶ÁÈ¡ÖÜÆÚ¼ÆÊ±¼ÆÊýÒµÎñ*/
                              if(couter_ds18b20Temperature_dtPeriod)couter_ds18b20Temperature_dtPeriod --;
                              
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SCENARIO)
                              /*²»Í¬³¡¾°´¥·¢°´¼üÇ¿ÖÆ¼ä¸ôÊ±¼ä¼ÆÊý*/
                              if(scenario_ActParam.scenarioKeepTrig_timeCounter != COUNTER_DISENABLE_MASK_SPECIALVAL_U8){ //ÅÐ¶Ï¼ÆÊ±ÊÇ
             -·ñ¿ÉÓÃ£¬ÊÇ·ñÎª¼ÆÊ±Ê§Ð§ÑÚÂë
                              
                                      if(scenario_ActParam.scenarioKeepTrig_timeCounter)scenario_ActParam.scenarioKeepTrig_timeCounter --;
                                      else{
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 7   

                                      
                                              scenario_ActParam.scenarioKeepTrig_timeCounter = COUNTER_DISENABLE_MASK_SPECIALVAL_U8;
              //                              scenario_ActParam.scenarioKey_currentTrig = scenarioKey_current_null; //ÔÝÊ±È¡Ïû×Ô»Ö¸´
                                      }
                              }
                              
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
                              /*ÈÈË®Æ÷¼ÌµçÆ÷×Ô¶¯¹Ø±ÕÄ£Ê½ÏÂ¼ÆÊ±¼ÆÊý*/
                              if(heater_ActParam.timerClose_counter != COUNTER_DISENABLE_MASK_SPECIALVAL_U16){ //ÅÐ¶Ï¼ÆÊ±ÊÇ·ñ¿ÉÓÃ£¬ÊÇ·
             -ñÎª¼ÆÊ±Ê§Ð§ÑÚÂë
                              
                                      if(heater_ActParam.timerClose_counter)heater_ActParam.timerClose_counter --; //ÈÈË®Æ÷ÑÓÊ±¹Ø±Õ¼ÆÊ±ÒµÎñÂß
             -¼­
                                      else{
                                      
                                              heater_ActParam.timerClose_counter = COUNTER_DISENABLE_MASK_SPECIALVAL_U16;
                                              
                                              if((heater_ActParam.heater_currentActMode == heaterActMode_swCloseDelay30min) || //ÑÓÊ±¹Ø±ÕÄ£Ê½ÏÂ ÒµÎñ
             -²ÅÓÐÐ§
                                                 (heater_ActParam.heater_currentActMode == heaterActMode_swCloseDelay60min)){
                                                 
                                                      swCommand_fromUsr.objRelay = 0;
                                                      swCommand_fromUsr.actMethod = relay_OnOff; //¿ª¹Ø¶¯×÷
                                                         
                                                      devActionPush_IF.push_IF = 1; //ÍÆËÍÊ¹ÄÜ
                                                      
                                                      heater_ActParam.heater_currentActMode = heaterActMode_swClose;  
                                              }
                                      }
                              }
                              
              #else
 383   2      #endif
 384   2                      /*ÐÄÌø°ü¼ÆÊ±¼ÆÊýÒµÎñ*/
 385   2                      if(!heartBeatCycle_FLG){
 386   3                      
 387   3                              if(heartBeatCount < heartBeatPeriod)heartBeatCount ++;
 388   3                              else{
 389   4                              
 390   4                                      heartBeatCount = 0;
 391   4                                      heartBeatCycle_FLG = 1;
 392   4                              }
 393   3                      }
 394   2                      
 395   2                      /*ÑÓÊ±¼ÆÊ±ÒµÎñ£¬µ½µã¶¯×÷*/
 396   2                      if(ifDelay_sw_running_FLAG & (1 << 1)){
 397   3                      
 398   3                              if(delayCnt_onoff < ((u16)delayPeriod_onoff * 60))delayCnt_onoff ++;
 399   3                              else{
 400   4                              
 401   4                                      delayPeriod_onoff = delayCnt_onoff = 0; 
 402   4                                      
 403   4                                      ifDelay_sw_running_FLAG &= ~(1 << 1);   //Ò»´ÎÐÔ±êÖ¾Çå³ý
 404   4                                      
 405   4                                      swCommand_fromUsr.actMethod = relay_OnOff; //¿ª¹Ø¶¯×÷
 406   4                                      swCommand_fromUsr.objRelay = delayUp_act;
 407   4                                      devActionPush_IF.push_IF = 1; //ÍÆËÍÊ¹ÄÜ -Ö÷¶¯ÉÏ´«
 408   4                                      dev_agingCmd_sndInitative.agingCmd_delaySetOpreat = 1; //¶ÔÓ¦Ö÷¶¯ÉÏ´«Ê±Ð§Õ¼Î»ÖÃÒ»
 409   4                                      
 410   4      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
                                              EACHCTRL_realesFLG = 1;
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 8   

                                              
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SCENARIO)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
                                              (swCommand_fromUsr.objRelay == 0x01)?(heater_ActParam.heater_currentActMode = heaterActMode_swKeepOpen
             -):(heater_ActParam.heater_currentActMode = heaterActMode_swClose); //°´¼ü×´Ì¬Á¢Âí¸üÐÂ
                                              devHeater_actOpeartionExecute(heater_ActParam.heater_currentActMode); //¶¯×÷Ö´ÐÐ
              
              #else
 422   4                                      if(SWITCH_TYPE == SWITCH_TYPE_SWBIT1 || SWITCH_TYPE == SWITCH_TYPE_SWBIT2 || SWITCH_TYPE == SWITCH_TYP
             -E_SWBIT3)EACHCTRL_realesFLG |= (status_Relay ^ swCommand_fromUsr.objRelay); //ÓÐÐ§»¥¿Ø´¥·¢
 423   4                                      else
 424   4                                      if(SWITCH_TYPE == SWITCH_TYPE_CURTAIN)EACHCTRL_realesFLG = 1; //ÓÐÐ§»¥¿Ø´¥·¢
 425   4                                      
 426   4      #endif          
 427   4                                      /*>>>usr_debug<<<*/
 428   4                                      //usr_debugÊý¾ÝÌî×°
 429   4                                      dev_debugInfoLog.debugInfoData.delayActInfo.delayAct_Up = 1;
 430   4                                      //usr_debug´òÓ¡ÀàÐÍÌî×°Ìî×°
 431   4                                      dev_debugInfoLog.debugInfoType = infoType_delayUp;
 432   4                              }
 433   3                      }
 434   2                      
 435   2                      /*ÂÌÉ«Ä£Ê½¼ÆÊ±ÒµÎñ£¬Ñ­»·¹Ø±Õ*/
 436   2                      if((ifDelay_sw_running_FLAG & (1 << 0)) && status_Relay){
 437   3                      
 438   3                              if(delayCnt_closeLoop < ((u16)delayPeriod_closeLoop * 60))delayCnt_closeLoop ++;
 439   3                              else{
 440   4                                      
 441   4                                      delayCnt_closeLoop = 0;
 442   4                              
 443   4                                      swCommand_fromUsr.actMethod = relay_OnOff; //¿ª¹Ø¶¯×÷
 444   4                                      swCommand_fromUsr.objRelay = 0;
 445   4                                      devActionPush_IF.push_IF = 1; //ÍÆËÍÊ¹ÄÜ -Ö÷¶¯ÉÏ´«
 446   4                                      dev_agingCmd_sndInitative.agingCmd_greenModeSetOpreat = 1; //¶ÔÓ¦Ö÷¶¯ÉÏ´«Ê±Ð§Õ¼Î»ÖÃÒ»
 447   4                              
 448   4      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_FANS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_dIMMER)
                                              EACHCTRL_realesFLG = 1;
                                              
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
              #elif(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_HEATER)
                                              (swCommand_fromUsr.objRelay == 0x01)?(heater_ActParam.heater_currentActMode = heaterActMode_swKeepOpen
             -):(heater_ActParam.heater_currentActMode = heaterActMode_swClose); //°´¼ü×´Ì¬Á¢Âí¸üÐÂ
                                              devHeater_actOpeartionExecute(heater_ActParam.heater_currentActMode); //¶¯×÷Ö´ÐÐ
                                              
              #else
 459   4                                      if(SWITCH_TYPE == SWITCH_TYPE_SWBIT1 || SWITCH_TYPE == SWITCH_TYPE_SWBIT2 || SWITCH_TYPE == SWITCH_TYP
             -E_SWBIT3)EACHCTRL_realesFLG |= (status_Relay ^ swCommand_fromUsr.objRelay); //ÓÐÐ§»¥¿Ø´¥·¢
 460   4                                      else
 461   4                                      if(SWITCH_TYPE == SWITCH_TYPE_CURTAIN)EACHCTRL_realesFLG = 1; //ÓÐÐ§»¥¿Ø´¥·¢
 462   4                                      
 463   4      #endif  
 464   4                              }
 465   3                      }
 466   2                      
 467   2                      /*³¡¾°ÖÜÆÚÑ¯²é¹ÒÆð¼ÆÊ±Öµ¸üÐÂ*///¹ÒÆð×÷ÓÃ<<
 468   2                      if(heartBeatHang_timeCnt)heartBeatHang_timeCnt --;
 469   2                      
 470   2                      /*ÐÄÌø¹ÒÆð¼ÆÊ±Öµ¸üÐÂ*///¹ÒÆð×÷ÓÃ<<
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 9   

 471   2                      if(colonyCtrlGetHang_timeCnt)colonyCtrlGetHang_timeCnt --;
 472   2                      
 473   2                      /*ÏµÍ³Ê±¼ä±¾µØÎ¬³Ö¼ÆÊýÖµ¸üÐÂ*/
 474   2                      sysTimeKeep_counter ++;
 475   2                      
 476   2                      /*tips¿ÕÏÐÊÍ·Å¼ÆÊ±¼ÆÊýÒµÎñ*/
 477   2                      if(counter_ifTipsFree && countEN_ifTipsFree)counter_ifTipsFree --;
 478   2                      
 479   2                      /*ÏµÍ³Ê±¼äÖÜÆÚÐÂ¸üÐÂ¼ÆÊ±¼ÆÊýÒµÎñ*/
 480   2                      if(sysTimeReales_counter)sysTimeReales_counter --;
 481   2                      
 482   2                      /*zigbÍøÂç¿ª·Åµ¹¼ÆÊ±*/
 483   2                      if(tipsTimeCount_zigNwkOpen)tipsTimeCount_zigNwkOpen --;
 484   2                      
 485   2                      /*Éè±¸ÍøÂç¹ÒÆðÊ±¼äµ¹¼ÆÊ±*///¹ÒÆð×÷ÓÃ<<
 486   2                      if(devNwkHoldTime_Param.devHoldTime_counter)devNwkHoldTime_Param.devHoldTime_counter --;
 487   2                      
 488   2                      /*¼¯ÈºÊÜ¿Ø×´Ì¬ÖÜÆÚÐÔÂÖÑ¯ÖÜÆÚ¼ÆÊ±*/
 489   2                      if(colonyCtrlGet_queryCounter)colonyCtrlGet_queryCounter --;
 490   2                      
 491   2                      /*´¥ÃþIC¸´Î»Ê±¼äµ¹¼ÆÊ±*/
 492   2                      if(touchPad_resetTimeCount)touchPad_resetTimeCount --;
 493   2                      
 494   2                      /*´¥ÃþIC¸´Î»Tipsµ¹¼ÆÊ±*/
 495   2                      if(tipsTimeCount_touchReset)tipsTimeCount_touchReset --;
 496   2                      
 497   2                      /*»Ö¸´Ô¤ÖÃ¶¯×÷µ¹¼ÆÊ±*/
 498   2                      if(factoryRecover_HoldTimeCount)factoryRecover_HoldTimeCount --;
 499   2                      
 500   2                      /*»Ö¸´³ö³§Tipsµ¹¼ÆÊ±*/
 501   2                      if(tipsTimeCount_factoryRecover)tipsTimeCount_factoryRecover --;
 502   2                      
 503   2                      /*Ð­µ÷Æ÷Ê§Áª/¶ªÊ§ È·ÈÏµ¹¼ÆÊ±*/
 504   2                      if(timeCounter_coordinatorLost_detecting)timeCounter_coordinatorLost_detecting --;
 505   2              }
 506   1      
 507   1              //***************´®¿Ú½ÓÊÕ³¬Ê±Ê±³¤¼ÆÊý*******************************//
 508   1              if(rxTout_count_EN){ //½ÓÊÕ³¬Ê±¼ÆÊ±Ê¹ÄÜÅÐ¶Ï
 509   2              
 510   2                      if(rxTout_count < TimeOutSet1)rxTout_count ++;
 511   2                      else{
 512   3                              
 513   3                              if(!uartRX_toutFLG && datsRcv_length >= 5){ //³¬Ê±Ê±¼äÅÐ¶Ï¼°×îÐ¡Ö¡³¤ÅÐ¶Ï
 514   4                              
 515   4                                      uartRX_toutFLG = 1;
 516   4                              
 517   4                                      memset(datsRcv_ZIGB.rcvDats, 0xff, sizeof(char) * COM_RX1_Lenth);
 518   4                                      memcpy(datsRcv_ZIGB.rcvDats, RX1_Buffer, COM_RX1_Lenth);
 519   4                                      datsRcv_ZIGB.rcvDatsLen = datsRcv_length;
 520   4                                      
 521   4                                      /*>>>usr_debug<<<*/
 522   4                                      if(datsRcv_length != (datsRcv_ZIGB.rcvDats[1] + 5)){  //±êµÄÖ¡³¤ÅÐ¶Ï£¬ÊÇ·ñ³¬³¤
 523   5                                      
 524   5                                              //usr_debugÊý¾ÝÌî×°
 525   5                                              dev_debugInfoLog.debugInfoData.frameInfo.frameIllegal_FLG = 1;
 526   5                                              dev_debugInfoLog.debugInfoData.frameInfo.frame_aLength = RX1_Buffer[1];
 527   5                                              dev_debugInfoLog.debugInfoData.frameInfo.frame_rLength = datsRcv_length;
 528   5                                              //usr_debug´òÓ¡ÀàÐÍÌî×°Ìî×°
 529   5                                              dev_debugInfoLog.debugInfoType = infoType_frameUart;
 530   5                                              
 531   5                                      }else{
 532   5                                      
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 10  

 533   5      
 534   5                                      }
 535   4                              }
 536   3                              rxTout_count_EN = 0;
 537   3                      }
 538   2              }
 539   1              
 540   1              //*******************beep¼ÆÊ±¼ÆÊýÒµÎñ**************************/
 541   1              if(count_beep < period_beep)count_beep ++;
 542   1              else{
 543   2                      
 544   2                      static u16 xdata        tips_Period = 20 * 50 / 2;
 545   2                      static u16 xdata        tips_Count      = 0;
 546   2                      static u8 xdata         tips_Loop       = 2 * 4;
 547   2                      static bit                      beeps_en        = 1;
 548   2              
 549   2                      count_beep = 0;
 550   2      
 551   2                      switch(dev_statusBeeps){ //×´Ì¬»ú
 552   3                              
 553   3                              case beepsMode_standBy:{
 554   4                                      
 555   4                                      period_beep = devTips_beep.tips_Period;
 556   4                                      tips_Period = 20 * devTips_beep.tips_time / period_beep;
 557   4                                      tips_Loop       = 2 * devTips_beep.tips_loop;
 558   4                                      tips_Count      = 0;
 559   4                                      beeps_en        = 1;
 560   4                                      dev_statusBeeps = beepsWorking;
 561   4              
 562   4                              }break;
 563   3                              
 564   3                              case beepsWorking:{
 565   4                              
 566   4                                      if(tips_Loop){
 567   5                                      
 568   5                                              if(tips_Count < tips_Period){
 569   6                                              
 570   6                                                      tips_Count ++;
 571   6                                                      (beeps_en)?(PIN_BEEP = !PIN_BEEP):(PIN_BEEP = !BEEP_OPEN_LEVEL);
 572   6                                                      
 573   6                                              }else{
 574   6                                              
 575   6                                                      tips_Count = 0;
 576   6                                                      beeps_en = !beeps_en;
 577   6                                                      tips_Loop --;
 578   6                                              }
 579   5                                              
 580   5                                      }else{
 581   5                                      
 582   5                                              dev_statusBeeps = beepsComplete;
 583   5                                      }
 584   4                              
 585   4                              }break;
 586   3                              
 587   3                              case beepsComplete:{
 588   4                              
 589   4                                      tips_Count = 0;
 590   4                                      beeps_en = 1;
 591   4                                      PIN_BEEP = !BEEP_OPEN_LEVEL;
 592   4                                      dev_statusBeeps = beepsMode_null;
 593   4                                      
 594   4                              }break;
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 11  

 595   3                      
 596   3                              default:{
 597   4                              
 598   4                                      PIN_BEEP = !BEEP_OPEN_LEVEL;
 599   4                                      
 600   4                              }break;
 601   3                      }
 602   2              }
 603   1              
 604   1              //***************tips_Led Ë¢ÐÂÒµÎñ*******************************//
 605   1              if(counter_tipsColor > period_tipsColor){       //»Ò¶ÈÖµÖµ¼ÓÔØ
 606   2              
 607   2                      counter_tipsColor = 0;
 608   2                      
 609   2                      cnt_relay1_Tips.colorGray_R = relay1_Tips.colorGray_R;
 610   2                      cnt_relay1_Tips.colorGray_G = relay1_Tips.colorGray_G;
 611   2                      cnt_relay1_Tips.colorGray_B = relay1_Tips.colorGray_B;
 612   2                      
 613   2                      cnt_relay2_Tips.colorGray_R = relay2_Tips.colorGray_R;
 614   2                      cnt_relay2_Tips.colorGray_G = relay2_Tips.colorGray_G;
 615   2                      cnt_relay2_Tips.colorGray_B = relay2_Tips.colorGray_B;
 616   2                      
 617   2                      cnt_relay3_Tips.colorGray_R = relay3_Tips.colorGray_R;
 618   2                      cnt_relay3_Tips.colorGray_G = relay3_Tips.colorGray_G;
 619   2                      cnt_relay3_Tips.colorGray_B = relay3_Tips.colorGray_B;
 620   2                      
 621   2                      cnt_zigbNwk_Tips.colorGray_R = zigbNwk_Tips.colorGray_R;
 622   2                      cnt_zigbNwk_Tips.colorGray_G = zigbNwk_Tips.colorGray_G;
 623   2                      cnt_zigbNwk_Tips.colorGray_B = zigbNwk_Tips.colorGray_B;
 624   2              }
 625   1              else{ //pwmÖ´ÐÐ
 626   2              
 627   2                      counter_tipsColor ++;
 628   2                      
 629   2      #if(SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_SOCKETS || SWITCH_TYPE_FORCEDEF == SWITCH_TYPE_INFRARED)
                              
                              if((counter_tipsColor > 0) && (counter_tipsColor <= (COLORGRAY_MAX * 1))){
                                      
                                       //Ö¸Ê¾¿ÉÓÃºË×¼
                                      if(cnt_relay1_Tips.colorGray_R && (DEV_actReserve & 0x01)){cnt_relay1_Tips.colorGray_R --; PIN_TIPS_REL
             -AY1_R = 0;}
                                      else PIN_TIPS_RELAY1_R = 1;
                                      
                              }else
                              if((counter_tipsColor > (COLORGRAY_MAX * 2)) && (counter_tipsColor <= (COLORGRAY_MAX * 3))){
                              
                                       //Ö¸Ê¾¿ÉÓÃºË×¼
                                      if(cnt_relay1_Tips.colorGray_B && (DEV_actReserve & 0x01)){cnt_relay1_Tips.colorGray_B --; PIN_TIPS_REL
             -AY1_B = 0;}
                                      else PIN_TIPS_RELAY1_B = 1;
                              }               
              #else
 645   2                      
 646   2                      if((counter_tipsColor > 0) && (counter_tipsColor <= (COLORGRAY_MAX * 1))){
 647   3                              
 648   3                               //Ö¸Ê¾¿ÉÓÃºË×¼
 649   3                              if(cnt_relay1_Tips.colorGray_R && (DEV_actReserve & 0x01)){cnt_relay1_Tips.colorGray_R --; PIN_TIPS_REL
             -AY1_R = 0;}
 650   3                              else PIN_TIPS_RELAY1_R = 1;
 651   3                              if(cnt_relay2_Tips.colorGray_R && (DEV_actReserve & 0x02)){cnt_relay2_Tips.colorGray_R --; PIN_TIPS_REL
             -AY2_R = 0;}
 652   3                              else PIN_TIPS_RELAY2_R = 1;
C51 COMPILER V9.54   APPTIMER                                                              01/11/2019 12:04:13 PAGE 12  

 653   3                              if(cnt_relay3_Tips.colorGray_R && (DEV_actReserve & 0x04)){cnt_relay3_Tips.colorGray_R --; PIN_TIPS_REL
             -AY3_R = 0;}
 654   3                              else PIN_TIPS_RELAY3_R = 1;
 655   3                              if(cnt_zigbNwk_Tips.colorGray_R){cnt_zigbNwk_Tips.colorGray_R --; PIN_TIPS_ZIGBNWK_R = 0;}
 656   3                              else PIN_TIPS_ZIGBNWK_R = 1;
 657   3                              
 658   3                      }else
 659   2                      if((counter_tipsColor > (COLORGRAY_MAX * 1)) && (counter_tipsColor <= (COLORGRAY_MAX * 2))){
 660   3                      
 661   3                               //Ö¸Ê¾¿ÉÓÃºË×¼
 662   3                              if(cnt_relay1_Tips.colorGray_G && (DEV_actReserve & 0x01)){cnt_relay1_Tips.colorGray_G --; PIN_TIPS_REL
             -AY1_G = 0;}
 663   3                              else PIN_TIPS_RELAY1_G = 1;
 664   3                              if(cnt_relay2_Tips.colorGray_G && (DEV_actReserve & 0x02)){cnt_relay2_Tips.colorGray_G --; PIN_TIPS_REL
             -AY2_G = 0;}
 665   3                              else PIN_TIPS_RELAY2_G = 1;
 666   3                              if(cnt_relay3_Tips.colorGray_G && (DEV_actReserve & 0x04)){cnt_relay3_Tips.colorGray_G --; PIN_TIPS_REL
             -AY3_G = 0;}
 667   3                              else PIN_TIPS_RELAY3_G = 1;
 668   3                              if(cnt_zigbNwk_Tips.colorGray_G){cnt_zigbNwk_Tips.colorGray_G --; PIN_TIPS_ZIGBNWK_G = 0;}
 669   3                              else PIN_TIPS_ZIGBNWK_G = 1;
 670   3                              
 671   3                      }else
 672   2                      if((counter_tipsColor > (COLORGRAY_MAX * 2)) && (counter_tipsColor <= (COLORGRAY_MAX * 3))){
 673   3                      
 674   3                               //Ö¸Ê¾¿ÉÓÃºË×¼
 675   3                              if(cnt_relay1_Tips.colorGray_B && (DEV_actReserve & 0x01)){cnt_relay1_Tips.colorGray_B --; PIN_TIPS_REL
             -AY1_B = 0;}
 676   3                              else PIN_TIPS_RELAY1_B = 1;
 677   3                              if(cnt_relay2_Tips.colorGray_B && (DEV_actReserve & 0x02)){cnt_relay2_Tips.colorGray_B --; PIN_TIPS_REL
             -AY2_B = 0;}
 678   3                              else PIN_TIPS_RELAY2_B = 1;
 679   3                              if(cnt_relay3_Tips.colorGray_B && (DEV_actReserve & 0x04)){cnt_relay3_Tips.colorGray_B --; PIN_TIPS_REL
             -AY3_B = 0;}
 680   3                              else PIN_TIPS_RELAY3_B = 1;
 681   3                              if(cnt_zigbNwk_Tips.colorGray_B){cnt_zigbNwk_Tips.colorGray_B --; PIN_TIPS_ZIGBNWK_B = 0;}
 682   3                              else PIN_TIPS_ZIGBNWK_B = 1;
 683   3                      }
 684   2      #endif
 685   2              }
 686   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1690    ----
   CONSTANT SIZE    =      7    ----
   XDATA SIZE       =     19    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
